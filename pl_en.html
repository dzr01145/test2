<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Liability News</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            margin: 0;
            padding: 0;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .header-top {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
        }

        .header-filters {
            padding: 10px 20px;
            background: rgba(255,255,255,0.1);
        }

        .filters-content {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            margin: 0;
            font-size: 1.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .lang-switch-container {
            text-align: right;
            margin-bottom: 15px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 160px 20px 20px;
        }

        button, .lang-switch {
            background: white;
            color: #667eea;
            border: 2px solid white;
            padding: 8px 20px;
            font-size: 1em;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
        }

        button:hover, .lang-switch:hover {
            background: rgba(255,255,255,0.9);
            transform: translateY(-2px);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .stats-inline {
            color: white;
            font-size: 1em;
            font-weight: bold;
        }

        #loading {
            text-align: center;
            color: #667eea;
            font-size: 1.2em;
            margin: 20px 0;
            display: none;
        }

        .spinner {
            border: 4px solid rgba(102,126,234,0.3);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #results {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        @media (max-width: 1024px) {
            #results {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 640px) {
            #results {
                grid-template-columns: 1fr;
            }

            .header-content {
                flex-direction: column;
                text-align: center;
            }

            h1 {
                font-size: 1.2em;
            }

            .container {
                padding-top: 200px;
            }

            .category-filters label {
                display: block;
                margin-bottom: 8px;
            }
        }

        .news-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .news-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .news-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            line-height: 1.4;
            flex-grow: 1;
        }

        .news-title a {
            color: #667eea;
            text-decoration: none;
        }

        .news-title a:hover {
            text-decoration: underline;
        }

        .news-meta {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
        }


        .matched-keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }

        .matched-keyword {
            background: #ffd700;
            color: #333;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .no-results {
            text-align: center;
            color: #667eea;
            font-size: 1.2em;
            background: white;
            padding: 40px;
            border-radius: 10px;
            grid-column: 1 / -1;
        }

        .category-filters label {
            display: inline-block;
            margin-right: 15px;
            margin-bottom: 0;
            font-weight: bold;
            color: white;
            font-size: 0.9em;
            vertical-align: middle;
        }

        .category-buttons {
            display: inline-flex;
            flex-wrap: wrap;
            gap: 6px;
            vertical-align: middle;
        }

        .category-btn {
            padding: 5px 12px;
            border: 1px solid rgba(255,255,255,0.5);
            background: rgba(255,255,255,0.1);
            color: white;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.8em;
            font-weight: 500;
        }

        .category-btn:hover {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.8);
        }

        .category-btn.active {
            background: white;
            color: #667eea;
            border-color: white;
        }

        .category-badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .matched-keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: auto;
            padding-top: 10px;
        }

        .matched-keyword {
            background: #ffd700;
            color: #333;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75em;
            font-weight: bold;
        }

        .news-meta {
            color: #666;
            font-size: 0.8em;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-top">
            <div class="header-content">
                <h1>Product Liability News</h1>
                <div class="controls">
                    <span id="stats" class="stats-inline" style="display: none;"></span>
                    <button id="fetchBtn" onclick="fetchNews()">Refresh</button>
                    <a class="lang-switch" href="index.html">日本語版</a>
                </div>
            </div>
        </div>
        <div id="categoryFilters" style="display: none;" class="header-filters">
            <div class="filters-content category-filters">
                <label>Filter by Category:</label>
                <div class="category-buttons" id="categoryButtons"></div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="lang-switch-container">
            <a class="lang-switch" href="index.html">日本語版</a>
        </div>
        <div id="loading">
            <div class="spinner"></div>
            <div>Fetching news...</div>
        </div>

        <div id="results"></div>
    </div>

    <script>
        // Product Liability related keywords
        const keywords = [
            'product liability',
            'products liability',
            'product recall',
            'recall',
            'defective product',
            'product defect',
            'manufacturing defect',
            'design defect',
            'product safety',
            'consumer safety',
            'product lawsuit',
            'class action',
            'FDA recall',
            'CPSC',
            'consumer product safety',
            'product warning',
            'failure to warn',
            'product hazard',
            'injury',
            'damages',
            'settlement',
            'product negligence',
            'strict liability',
            'breach of warranty',
            'unsafe product',
            'product contamination',
            'quality control',
            'quality issue',
            'product withdrawal',
            'safety recall',
            'product alert',
            'consumer protection',
            'FDA',
            'NHTSA',
            'vehicle recall',
            'drug recall',
            'food recall',
            'medical device recall'
        ];

        // Global variables
        let allNewsData = [];
        let selectedCategory = 'All';

        async function fetchNews() {
            const resultsDiv = document.getElementById('results');
            const loadingDiv = document.getElementById('loading');
            const statsDiv = document.getElementById('stats');
            const fetchBtn = document.getElementById('fetchBtn');

            resultsDiv.innerHTML = '';
            loadingDiv.style.display = 'block';
            statsDiv.style.display = 'none';
            fetchBtn.disabled = true;

            try {
                const allNews = [];

                // Multiple RSS feeds from international sources
                const rssUrls = [
                    'https://news.google.com/rss/search?q=product+recall&hl=en-US&gl=US&ceid=US:en',
                    'https://news.google.com/rss/search?q=product+liability&hl=en-US&gl=US&ceid=US:en',
                    'https://news.google.com/rss/search?q=FDA+recall&hl=en-US&gl=US&ceid=US:en',
                    'https://news.google.com/rss/search?q=CPSC+recall&hl=en-US&gl=US&ceid=US:en',
                    'https://news.google.com/rss/search?q=defective+product&hl=en-US&gl=US&ceid=US:en',
                    'https://news.google.com/rss/search?q=consumer+safety&hl=en-US&gl=US&ceid=US:en',
                    'https://news.google.com/rss/search?q=product+lawsuit&hl=en-US&gl=US&ceid=US:en'
                ];

                // CORS proxy to fetch RSS
                const corsProxy = 'https://api.allorigins.win/raw?url=';

                for (const rssUrl of rssUrls) {
                    try {
                        const response = await fetch(corsProxy + encodeURIComponent(rssUrl));
                        const text = await response.text();
                        const parser = new DOMParser();
                        const xmlDoc = parser.parseFromString(text, 'text/xml');

                        const items = xmlDoc.querySelectorAll('item');

                        items.forEach(item => {
                            const title = item.querySelector('title')?.textContent || '';
                            const link = item.querySelector('link')?.textContent || '';
                            const pubDate = item.querySelector('pubDate')?.textContent || '';
                            const description = item.querySelector('description')?.textContent || '';
                            const source = item.querySelector('source')?.textContent || '';

                            // Keyword matching
                            const matchedKeywords = keywords.filter(kw =>
                                title.toLowerCase().includes(kw.toLowerCase()) ||
                                description.toLowerCase().includes(kw.toLowerCase())
                            );

                            if (matchedKeywords.length > 0) {
                                // Category classification
                                let category = 'Other';
                                const titleDesc = (title + ' ' + description).toLowerCase();

                                if (titleDesc.includes('recall') || titleDesc.includes('withdrawal')) {
                                    if (titleDesc.includes('vehicle') || titleDesc.includes('car') || titleDesc.includes('auto') || titleDesc.includes('nhtsa')) {
                                        category = 'Vehicle Recalls';
                                    } else if (titleDesc.includes('drug') || titleDesc.includes('medication') || titleDesc.includes('pharmaceutical')) {
                                        category = 'Drug Recalls';
                                    } else if (titleDesc.includes('food') || titleDesc.includes('contamination') || titleDesc.includes('salmonella') || titleDesc.includes('listeria')) {
                                        category = 'Food Recalls';
                                    } else if (titleDesc.includes('medical device') || titleDesc.includes('implant')) {
                                        category = 'Medical Device Recalls';
                                    } else if (titleDesc.includes('consumer product') || titleDesc.includes('cpsc')) {
                                        category = 'Consumer Product Recalls';
                                    } else {
                                        category = 'Recalls';
                                    }
                                } else if (titleDesc.includes('lawsuit') || titleDesc.includes('class action') || titleDesc.includes('settlement') || titleDesc.includes('litigation')) {
                                    category = 'Lawsuits';
                                } else if (titleDesc.includes('defect') || titleDesc.includes('defective') || titleDesc.includes('malfunction')) {
                                    category = 'Product Defects';
                                } else if (titleDesc.includes('fda') || titleDesc.includes('cpsc') || titleDesc.includes('nhtsa') || titleDesc.includes('regulation')) {
                                    category = 'Regulatory';
                                } else if (titleDesc.includes('injury') || titleDesc.includes('death') || titleDesc.includes('accident')) {
                                    category = 'Safety Issues';
                                } else if (titleDesc.includes('quality') || titleDesc.includes('inspection') || titleDesc.includes('standard')) {
                                    category = 'Quality Control';
                                }

                                // Duplicate check
                                if (!allNews.find(n => n.link === link)) {
                                    // Clean description
                                    let cleanDesc = description.replace(/<[^>]*>/g, '').trim();

                                    if (cleanDesc.startsWith(title)) {
                                        cleanDesc = cleanDesc.substring(title.length).trim();
                                    }

                                    cleanDesc = cleanDesc.replace(/^[・\s\-—…]+/, '').trim();

                                    if (cleanDesc.length > 200) {
                                        cleanDesc = cleanDesc.substring(0, 200) + '...';
                                    }

                                    allNews.push({
                                        title,
                                        link,
                                        pubDate,
                                        description: cleanDesc,
                                        source,
                                        matchedKeywords,
                                        category
                                    });
                                }
                            }
                        });
                    } catch (err) {
                        console.error('Error fetching RSS:', err);
                    }
                }

                // Sort by date (newest first)
                allNews.sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));

                loadingDiv.style.display = 'none';

                if (allNews.length > 0) {
                    allNewsData = allNews;
                    statsDiv.style.display = 'inline-block';
                    statsDiv.textContent = `${allNews.length} articles`;

                    // Create category buttons
                    createCategoryButtons();

                    // Display news
                    displayNews(allNewsData);
                } else {
                    resultsDiv.innerHTML = '<div class="no-results">No product liability news found.<br>Please try again later.</div>';
                }
            } catch (error) {
                console.error('Error:', error);
                loadingDiv.style.display = 'none';
                resultsDiv.innerHTML = `<div class="no-results">Failed to fetch news.<br><br>Please check your internet connection and try again.<br><br>Error: ${error.message}</div>`;
            }

            fetchBtn.disabled = false;
        }

        // Create category buttons
        function createCategoryButtons() {
            const categoryFiltersDiv = document.getElementById('categoryFilters');
            const categoryButtonsDiv = document.getElementById('categoryButtons');

            // Count by category
            const categoryCounts = {};
            allNewsData.forEach(news => {
                const category = news.category || 'Other';
                categoryCounts[category] = (categoryCounts[category] || 0) + 1;
            });

            // Sort by count
            const sortedCategories = Object.entries(categoryCounts).sort((a, b) => b[1] - a[1]);

            // Generate buttons
            categoryButtonsDiv.innerHTML = '';

            // "All" button
            const allBtn = document.createElement('button');
            allBtn.className = 'category-btn active';
            allBtn.textContent = `All (${allNewsData.length})`;
            allBtn.onclick = () => filterByCategory('All');
            categoryButtonsDiv.appendChild(allBtn);

            // Category buttons
            sortedCategories.forEach(([category, count]) => {
                const btn = document.createElement('button');
                btn.className = 'category-btn';
                btn.textContent = `${category} (${count})`;
                btn.onclick = () => filterByCategory(category);
                categoryButtonsDiv.appendChild(btn);
            });

            categoryFiltersDiv.style.display = 'block';
            // Adjust header height
            setTimeout(() => {
                const headerHeight = document.querySelector('.header').offsetHeight;
                document.querySelector('.container').style.paddingTop = (headerHeight + 20) + 'px';
            }, 100);
        }

        // Filter by category
        function filterByCategory(category) {
            selectedCategory = category;

            // Update button active state
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Filter and display
            let filteredNews = allNewsData;
            if (category !== 'All') {
                filteredNews = allNewsData.filter(news => news.category === category);
            }

            displayNews(filteredNews);
        }

        // Display news
        function displayNews(newsArray) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';

            newsArray.forEach(news => {
                const newsItem = document.createElement('div');
                newsItem.className = 'news-item';

                const formattedDate = new Date(news.pubDate).toLocaleString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                newsItem.innerHTML = `
                    <div class="category-badge">${news.category || 'Other'}</div>
                    <div class="news-title">
                        <a href="${news.link}" target="_blank">${news.title}</a>
                    </div>
                    <div class="news-meta">${formattedDate} | ${news.source || ''}</div>
                    <div class="matched-keywords">
                        ${news.matchedKeywords.slice(0, 5).map(kw => `<span class="matched-keyword">${kw}</span>`).join('')}
                    </div>
                `;

                resultsDiv.appendChild(newsItem);
            });
        }

        // Auto-fetch news on page load
        window.addEventListener('load', () => {
            fetchNews();
        });
    </script>
</body>
</html>
